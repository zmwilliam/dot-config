# Create a worktree in ../worktree/ with the repo-branch pattern and copy .env
wt branch:
    #!/usr/bin/env bash
    set -euo pipefail
    
    # Fetch latest changes from origin
    echo "Fetching latest changes from origin..."
    git fetch origin
    echo ""
    
    # Get the current repo name
    repo_name=$(basename $(git rev-parse --show-toplevel))
    repo_root=$(git rev-parse --show-toplevel)
    
    # Create worktree directory name: repo-name-branch
    worktree_name="${repo_name}-{{branch}}"
    
    # Get the parent directory of the current repo
    parent_dir=$(dirname "$repo_root")
    
    # Full path for the new worktree
    worktree_path="${parent_dir}/worktree/${worktree_name}"
    
    echo "Creating worktree at: ${worktree_path}"
    git worktree add "${worktree_path}" "{{branch}}"
    
    # Copy .env if it exists
    if [ -f "${repo_root}/.env" ]; then
        echo "Copying .env file..."
        cp "${repo_root}/.env" "${worktree_path}/"
        echo "✓ .env copied"
    fi
    
    echo ""
    echo "✓ Worktree created successfully!"
    echo ""
    
    # Ask if user wants to switch to the worktree
    read -p "Do you want to switch to the worktree directory? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        cd "${worktree_path}" && exec $SHELL
    else
        echo "To switch to the worktree later, run:"
        echo "  cd ${worktree_path}"
    fi

# Create a worktree with a NEW branch
wt-new branch:
    #!/usr/bin/env bash
    set -euo pipefail
    
    # Fetch latest changes from origin
    echo "Fetching latest changes from origin..."
    git fetch origin
    echo ""
    
    repo_name=$(basename $(git rev-parse --show-toplevel))
    repo_root=$(git rev-parse --show-toplevel)
    parent_dir=$(dirname "$repo_root")
    worktree_name="${repo_name}-{{branch}}"
    worktree_path="${parent_dir}/worktree/${worktree_name}"
    
    echo "Creating worktree with new branch at: ${worktree_path}"
    git worktree add -b "{{branch}}" "${worktree_path}"
    
    if [ -f "${repo_root}/.env" ]; then
        echo "Copying .env file..."
        cp "${repo_root}/.env" "${worktree_path}/"
        echo "✓ .env copied"
    fi
    
    echo ""
    echo "✓ Worktree created successfully!"
    echo ""
    
    # Ask if user wants to switch to the worktree
    read -p "Do you want to switch to the worktree directory? (y/n) " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        cd "${worktree_path}" && exec $SHELL
    else
        echo "To switch to the worktree later, run:"
        echo "  cd ${worktree_path}"
    fi

# List all worktrees
wt-list:
    git worktree list

# Remove a worktree by branch name
wt-remove branch:
    #!/usr/bin/env bash
    set -euo pipefail
    
    repo_name=$(basename $(git rev-parse --show-toplevel))
    parent_dir=$(dirname $(git rev-parse --show-toplevel))
    worktree_name="${repo_name}-{{branch}}"
    worktree_path="${parent_dir}/worktree/${worktree_name}"
    
    echo "Removing worktree: ${worktree_path}"
    git worktree remove "${worktree_path}"
    echo "✓ Worktree removed successfully!"

# Prune deleted worktrees
wt-prune:
    git worktree prune
